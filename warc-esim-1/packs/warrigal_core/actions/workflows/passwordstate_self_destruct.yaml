version: 1.0
tasks:
  # [262, 51]
  self_destruct_message:
    action: sim_passwordstate.self_destruct_message
    next:
      - do:
          - sleep_3
    input:
      log_level: DEBUG
      api_key: <%ctx().api_key%>
      api_url: <%ctx().url%>
      expires_at: <%ctx().expires_at%>
      message: <%ctx().mes%>
      no_views: 2
      passphrase: ethan2020
      to_email: <%ctx().to_email%>
  # [260, 301]
  send_mail:
    action: core.sendmail
    input:
      to: <%ctx().to_email%>
      from: SiM.Automation@ethan.com.au
      subject: User Account Creation Confirmation for <%ctx().display_name%>
      body: "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>User Account Creation Confirmation</title>\n</head>\n<body>\n<p>Dear <%ctx().requester_name%>,</p>\n<p>We are writing to confirm the successful creation of the user account as per your request. Kindly find the user's login credentials provided through our secure Password State self-destruct message system.</p>\n<p>Please take note of the following details:</p>\n<ul>\n  <li>Username: <%ctx().display_name%></li>\n  <li>User Email: <%ctx().user_email%></li>\n</ul>\n<p>Email with Password has been sent separately via password state.</p>\n<p>Passphrase for URL Access: <strong>ethan2020</strong></p>\n<p>For security purposes, we would like to highlight the following points:</p>\n<ul>\n  <li>The password message will self-destruct in 3 days if unopened.</li>\n  <li>You can access this message only twice.</li>\n</ul>\n<p>The user will be prompted to reset their password upon the first login.</p>\n<p>They should also link a mobile number to their account by logging into the following URL: <a href=\"https://warrigal.onelogin.com\">https://warrigal.onelogin.com</a></p>\n<p><strong>Profile &gt; Add 2-Factor Authentication Method (SMS).</strong></p>\n<p>If they require any assistance with the above, please give service desk a call.</p>\n<p>Kind regards,</p>\n<p>Sim Automation</p>\n</body>\n</html>\n"
  # [264, 179]
  sleep_3:
    action: core.local
    input:
      cmd: sleep 3
    next:
      - do:
          - send_mail
input:
  - url
  - api_key
  - expires_at
  - to_email
  - views
  - display_name
  - user_email
  - requester_name
  - pass
  - mes
  - message
