version: 1.0
tasks:
  # [19, 70]
  get_network_customer_site_details:
    action: sim_sec_alerts.get_network_customer_site_details
    next:
      - do:
          - delete_db
        when: <% succeeded() %>
        publish:
          - data: <% result().result %>
  # [668, 55]
  get_network_customer_device_os_details:
    action: sim_sec_alerts.get_network_customer_device_os_details
    next:
      - do:
          - delete_db3
        when: <% succeeded() %>
        publish:
          - data3: <% result().result %>
  # [332, 68]
  get_network_customer_site_devices_details:
    action: sim_sec_alerts.get_network_customer_site_devices_details
    next:
      - do:
          - delete_db2
        when: <% succeeded() %>
        publish:
          - data2: <% result().result %>
  # [19, 372]
  insert_to_db:
    action: sql.insert_bulk
    next:
      - do:
          - get_network_customer_site_devices_details
        when: <% succeeded() %>
    input:
      log_level: DEBUG
      connection: cloudmanagement
      data: "{{ctx().data}}"
      table: NetworkCustomerSitesBackup2
  # [332, 373]
  insert_to_db2:
    action: sql.insert_bulk
    next:
      - do:
          - get_network_customer_device_os_details
        when: <% succeeded() %>
    input:
      log_level: DEBUG
      connection: cloudmanagement
      data: "{{ctx().data2}}"
      table: NetworkCustomerSiteDevicesBackup2
  # [668, 373]
  insert_to_db3:
    action: sql.insert_bulk
    input:
      log_level: DEBUG
      data: "{{ctx().data3}}"
      table: NetworkCustomerDeviceOSBackup2
      connection: cloudmanagement
  # [19, 212]
  delete_db:
    action: sql.delete
    next:
      - do:
          - insert_to_db
        when: <% succeeded() %>
    input:
      log_level: DEBUG
      connection: cloudmanagement
      table: NetworkCustomerSitesBackup2
  # [332, 216]
  delete_db2:
    action: sql.delete
    next:
      - do:
          - insert_to_db2
        when: <% succeeded() %>
    input:
      log_level: DEBUG
      connection: cloudmanagement
      table: NetworkCustomerSiteDevicesBackup2
  # [668, 219]
  delete_db3:
    action: sql.delete
    next:
      - do:
          - insert_to_db3
        when: <% succeeded() %>
    input:
      log_level: DEBUG
      connection: cloudmanagement
      table: NetworkCustomerDeviceOSBackup2
