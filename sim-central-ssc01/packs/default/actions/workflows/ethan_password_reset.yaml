version: 1.0
tasks:
  # [360, 252]
  task1:
    action: core.http
    input:
      url: "https://sim-etest.sim.esecure.systems/api/v1/executions"
      allow_redirects: true
      body: "{\"action\": \"core.winrm_ps_cmd\", \"parameters\": {\"cmd\": \"Set-ADAccountPassword -Identity (Get-ADUser -Filter {UserPrincipalName -eq '{{ctx().username}}'}).DistinguishedName -Reset -NewPassword (ConvertTo-SecureString -AsPlainText 'Pass@12345' -Force)\", \"host\": \"10.234.16.10\", \"password\": \"Saturday123!\", \"username\": \"sim_test\", \"verify_ssl_cert\": false}"
      headers:
        St2-Api-Key: OWJjNGVhNDg3MmQ0MDM1NTc5ZjEyMzBiZmJhZTcwYmU0MTkxOWEwNTEwODY3MGU4NjA0Y2NhZTc5YmJiM2Y3OQ
      method: POST
      verify_ssl_cert: false
    next:
      - do:
          - task3
  # [360, 92]
  task2:
    action: core.http
    input:
      url: "https://api.api-ninjas.com/v1/passwordgenerator?length=8"
      headers:
        X-Api-Key: qBV62W546NbHNou4quFP+Q==0F4TsQPm5HYHy3sJ
    next:
      - do:
          - task1
        when: <% succeeded() %>
        publish:
          - password: <% result().result.random_password %>
  # [360, 383]
  task3:
    action: core.echo
    input:
      message: "{{ctx().password}}"
input:
  - username
